<!doctype html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <title>UnPieChart - undoing crappy pie charts</title>
  <meta name='description' content='Reverse engineering of pie chart images.'>
  <meta name='author' content='John Welford'>
  <link rel='stylesheet' href='styles.css?v=1.0'>
</head>

<body>
<h1>UnPieChart</h1>
<h2>Undoing crappy pie charts</h2>

<div id='dropZoneView' class='fill'>
  <div id='dropZone' tabindex=-1 contenteditable="true">
    <div id='intro'>
      <p>Pie charts are everywhere, but really <a href='http://www.perceptualedge.com/articles/visual_business_intelligence/save_the_pies_for_dessert.pdf'>aren't a great way to deliver information</a>.</p>
      <div><blockquote>
        <p>Piecharts are the information visualization equivalent of a roofing hammer to the frontal lobe.
        They have no place in the world of grownups, and occupy the same semiotic space as short pants, a runny nose, and chocolate smeared on oneâ€™s face.
        They are as professional as a pair of assless chaps.
        Anyone who suggests their use should be instinctively slapped.</p>
      </blockquote></div>
      <div class='author'><a href='https://codahale.com/about/'>Coda Hale</a></div>
      <p>Drag or paste a pie chart image here to convert it to a more useful set of data.</p>
      <!-- <label for="imgURL">To convert a pie chart to a more useful set of data drag or paste a pie chart image here, or paste the URL of a pie image below.</label>
      <input id="imgURL" name="imgURL" type="url"
              placeholder="http://www.examplePieChart.com/image.png"
              size="40"
              pattern="https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)(.jpg|.jpeg|.png|.gif)*"
              title="The URL must a .jpg, .png, or .gif image">
      <span class="validity"></span> -->
    </div>
    <img id='image' class='image'>
    <img id='orig' class='pieImage'>
    <canvas id='greyscale' class='pieImage'></canvas>
    <canvas id='blur' class='pieImage'></canvas>
    <canvas id='edges' class='pieImage'></canvas>
    <canvas id='output' class='pieImage'></canvas>
    <canvas id='crop' class='pieImage'></canvas>
    <canvas id='segment' class='pieImage'></canvas>
    <canvas id='pieless' class='pieImage'></canvas>
    <canvas id='legend' class='pieImage'></canvas>
    <div id='chart' class='pieImage'></div>
    <div id ='notification'><span class='notifyText'>test</span></div>
    <div id='dummyPaste'></div>
  </div>
</div>

<button id='start'>Stacked Bar</button>
<button id='reset'>Pie</button>

<table id='resultTable'></table>

<div id='questions'>
  <h3>Questions?</h3>
  <details>
    <summary><h4>How do I use this?</h4></summary>
    <p>Either drag an image file from your machine over the box above, or copy an image (from the web or anywhere else) then click the box above and paste it.</p>
  </details>
  <details>
    <summary><h4>It hasn't worked properly!</h4></summary>
    <p>Firstly, that's not a question. Secondly, this is a surprsingly difficult task to automate, involving a lot of complex processing. Try adjusting some parameters and retrying if you're keen.</p>
  </details>
  <details>
    <summary><h4>How does it work?</h4></summary>
    <p>
      <label for='processingDisplay'>Take a look through the processing steps:</label>
      <select name='processingDisplay' id='processingDisplay'></select>
    </p>
  </details>
  <details>
    <summary><h4>Can I adjust the settings to make it work better?</h4></summary>
    <p>To be added...</p>
  </details>
  <details>
    <summary><h4>Why is it slow?</h4></summary>
    <p>Everything is running in the browser, i.e. on your machine. This seemed easier that setting up a server, and it also means that it's your fault if it's slow.</p>
  </details>
  <details>
    <summary><h4>Who made this?</h4></summary>
    <p><a href='maito:john@extuitive.co.uk'>john@extuitive.co.uk</a></p>
  </details>
  <details>
    <summary><h4>Why did you make this?</h4></summary>
    <p>For fun. To play with image processing. To play with data visualisation. To make your life just a little bit better. To make data graphics just a little bit less shit.</p>
  </details>
  <details>
    <summary><h4>Did it take a long time?</h4></summary>
    <p>Yes. Yes, it did.</p>
  </details>
</div>

<br><br>
To do:
<ul>
  <li>Fix legend extraction</li>
  <li>Fix unroll of pie</li>
  <li>Transition unrolled pie off image</li>
  <li>Directly label unrolled pie</li>
  <li>Make work on mobile - add url option? fix sizing?</li>
  <li>Vertical stacked bar</li>
  <li>Unstacked bar</li>
  <li>Investigate 3D charts</li>
  <li>Add parameter tuning</li>
  <li>Try angle plus colour clustering (no segmentation) method</li>
  <li>Find directly labelled segments</li>
  <li>Try line detection method</li>
  <li>Add colour improvement option</li>
  <li>Add image save option</li>
  <li>Add table save option</li>
</ul>
<script src='https://d3js.org/d3.v5.min.js'></script>
<script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
<script async src='opencv.js' onload='onOpenCvReady();'></script>
<script src='process.js'></script>
<script src='imageProcess.js'></script>
<script src='segmentPie.js'></script>
<script src='extractText.js'></script>
<script src='newChart.js'></script>
</body>
</html>
